"use strict";angular.module("kAngularHowlerApp",[]),angular.module("kAngularHowlerApp").controller("AudioCtrl",["$document","$scope","$timeout",function(a,b,c){var d,e,f,g,h,i,j,k=this;h=function(a){return a>.5?k.data.volumeUp:.5>=a&&a>0?k.data.volumeDown:k.data.volumeOff},k.data={startIcon:"fa fa-play",stopIcon:"stop",pauseIcon:"fa fa-pause",volumeUp:"fa fa-volume-up",volumeDown:"fa fa-volume-down",volumeOff:"fa fa-volume-off"},d=function(){e=!1,k.playIcon=k.data.startIcon,clearInterval(i)};var j=function(a){this.playlist=a.slice(0)};j.prototype={play:function(a){var c=this.playlist;if(!(0>a||!c||0===!c.length||a>=c.length)){var f;a="number"==typeof a?a:0;var g=c[a];return f=g.howl?g.howl:g.howl=new Howl({src:g.src,volume:k.volume,html5:!0,onplay:function(a){k.duration=g.howl.duration(),e=!0,k.playIcon=k.data.pauseIcon,k.showSoundInfo=!0,k.showSpinner=!1,setInterval(i,500),b.$apply()},onload:function(){},onend:function(){d(),b.$apply()},onpause:function(){d(),b.$apply()},onstop:function(){d(),b.$apply()}}),k.accountImage=g.image,k.username=g.username,k.filename=g.filename,f.play()}},pause:function(a,b){var c=this.playlist;c[a]&&c[a].howl&&c[a].howl.pause(b)},stop:function(a,b){var c=this.playlist;try{c&&c[a].howl&&this.playlist[a].howl.stop(b)}catch(d){}},volumeChange:function(a,b){var c=this.playlist;c[a]&&c[a].howl&&(c[a].howl.volume(b),k.volumeIcon=h(b))},seek:function(a,b,c){var d=this.playlist;return d[a]&&d[a].howl?c?d[a].howl.seek(c,b):d[a].howl.seek(b):void 0}},g=function(){e=!1,k.volume=b.volume||.4,k.playbackPosition=0,k.duration=0,k.startOffset=0,k.showSoundInfo=!1,k.showSpinner=!1,k.showVolumeLevel=!1,k.thisIsVolumeRange=!1,k.volumeIcon=h(k.volume),k.volumeLevel=30,k.playIcon=k.data.startIcon,k.playlist=b.playlist,b.index&&b.index>0&&b.index<k.playlist.length?k.index=b.index:k.index=0,k.autoPlay=b.autoPlay||!1,f=new j(b.playlist),k.autoPlay&&k.play()},i=function(){k.startOffset=f.seek(k.index,k.soundId)||0,k.playbackPosition=100*k.startOffset/k.duration,b.$apply()},k.volumeChange=function(){f.volumeChange(k.index,k.volumeLevel/100)},k.timeChange=function(){try{c(function(){k.startOffset=k.playbackPosition*k.duration/100,f.seek(k.index,k.soundId,k.startOffset)},100)}catch(a){}},k.play=function(){e?f.pause(k.index,k.soundId):(k.showSpinner=!0,k.soundId=f.play(k.index))},k.move=function(a){var b="backward"===a?k.index-1||0:k.index+1;b>=0&&b<f.playlist.length&&(k.showSoundInfo=!1,f.stop(k.index),e=!1,k.index=b,k.play())},k.hideVolume=function(){k.showVolumeLevel=!1,k.thisIsVolumeRange=!1},k.showVolume=function(){k.thisIsVolumeRange||(k.showVolumeLevel=!k.showVolumeLevel),k.thisIsVolumeRange=!1},g()}]),angular.module("kAngularHowlerApp").directive("sonicAudio",[function(){return{templateUrl:"views/audio.html",controller:"AudioCtrl as audioCtrl",restrict:"E",replace:!0,scope:{playlist:"=",autoPlay:"=",index:"="},link:function(a,b,c){}}}]),angular.module("kAngularHowlerApp").filter("secondsToDateTime",[function(){return function(a){return new Date(1970,0,1).setSeconds(a)}}]),angular.module("kAngularHowlerApp").run(["$templateCache",function(a){a.put("views/audio.html",'<div class="sonic-audio-player-wrapper"> <div class="sonic-audio-player-base"></div> <!--<div class="sonic-audio-player-cover">--> <div class="sonic-audio-player"> <div class="sap-section"> <i class="sap-icon fa fa-step-backward" ng-click="audioCtrl.move(\'backward\')"></i> <i class="sap-icon {{audioCtrl.playIcon}}" ng-click="audioCtrl.play()"></i> <i class="sap-icon fa fa-step-forward" ng-click="audioCtrl.move()"></i> <!--<i class="sap-icon fa fa-stop" ng-click="audioCtrl.stop()"></i>--> <span class="sap-icon spn-icon-volume {{audioCtrl.volumeIcon}}" ng-click="audioCtrl.showVolume(this)" ng-mouseleave="audioCtrl.showVolumeLevel = false" asc-click-anywhere-but-here="audioCtrl.hideVolume()" stop-event="click"> <!--<span class="volume-level" ng-if="audioCtrl.showVolumeLevel">--> <input class="volume-level" type="range" class="level" ng-if="audioCtrl.showVolumeLevel" ng-click="audioCtrl.thisIsVolumeRange = true;" ng-change="audioCtrl.volumeChange()" ng-model="audioCtrl.volumeLevel"> </span> <!--</span>--> <span class="sap-spinner-icon-cover" ng-show="audioCtrl.showSpinner"> <span class="fa fa-cog fa-spin sap-spinner-icon"></span> </span> <span class="sap-info" ng-show="audioCtrl.showSoundInfo"> <img class="sap-info-image" src="{{audioCtrl.accountImage}}"> <span class="sap-name"> <span class="sap-info-user-name" ng-bind="audioCtrl.username"></span> <span class="sap-info-file-name"> {{audioCtrl.filename}} <span class="progressbar"> <span ng-show="audioCtrl.startOffset" class="sonic-audio-player-meter sonic-audio-player-meter-left"> {{ audioCtrl.startOffset | secondsToDateTime | date:\'mm:ss\'}}</span> <input class="progressbar-input" id="progressBar" type="range" ng-change="audioCtrl.timeChange()" ng-model="audioCtrl.playbackPosition"> <span class="sonic-audio-player-meter sonic-audio-player-meter-right"> {{ audioCtrl.duration | secondsToDateTime | date:\'mm:ss\'}}</span> </span> </span> </span> </span> </div><!--audio-player-first-section--> </div> <!--</div><!-sonic-audio-player-cover&ndash;&gt;--> </div><!--sonic-audio-player-wrapper-->')}]);